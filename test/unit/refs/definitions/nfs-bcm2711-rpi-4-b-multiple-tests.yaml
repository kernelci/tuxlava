device_type: "bcm2711-rpi-4-b"

job_name: "tuxlava@nfs-bcm2711-rpi-4-b: ltp-smoke, ltp-io, ltp-math, perf, kselftest-arm64, kunit"
priority: 50
visibility: "public"

context:
    arch: arm64
    booti_dtb_addr: '0x86000000'
    extra_nfsroot_args: ',vers=3'
    console_device: ttyS0
    extra_kernel_args: 8250.nr_uarts=1 cma=64M rootwait

timeouts:
  job:
    minutes: 121
  action:
   minutes: 5
  actions:
    power-off:
      seconds: 30

actions:
- deploy:
    to: tftp
    timeout:
      minutes: 5
    os: debian
    kernel:
      url: "https://example.com/Image.gz"
      compression: gz
      type: image
    modules:
      url: "https://example.com/modules.tar.xz"
      path: /usr/
      compression: xz
    nfsrootfs:
      url: "https://example.com/rootfs.tar.xz"
      compression: xz
      format: tar
      apply-overlay: true
      overlays:
        overlay-00:
          url: "https://example.com/ltp.tar.xz"
          path: "/"
          format: tar
          compression: xz
- boot:
    method:
      u-boot
    commands: nfs
    timeout:
      minutes: 15
    auto_login:
      login_prompt: 'login:'
      username: root
    prompts:
    - 'root@(.*):[/~]#'
- test:
    timeout:
      minutes: 2
    definitions:
    - repository: https://storage.tuxboot.com/test-definitions/2024.06.tar.zst
      lava-signal: kmsg
      from: url
      compression: zstd
      path: automated/linux/ltp/ltp.yaml
      parameters:
        SKIP_INSTALL: 'true'
        TST_CMDFILES: 'smoketest'
        SKIPFILE: '/tuxtest/skipfiles/arm64/ltp-smoke'
        ENVIRONMENT: 'production'
        LTP_TMPDIR: '/scratch'
        LTP_INSTALL_PATH: '/opt/ltp/'
        SHARD_NUMBER: 1
        SHARD_INDEX: 1
        TIMEOUT_MULTIPLIER: 5
      name: ltp-smoke
- test:
    timeout:
      minutes: 2
    definitions:
    - repository: https://storage.tuxboot.com/test-definitions/2024.06.tar.zst
      lava-signal: kmsg
      from: url
      compression: zstd
      path: automated/linux/ltp/ltp.yaml
      parameters:
        SKIP_INSTALL: 'true'
        TST_CMDFILES: 'io'
        SKIPFILE: '/tuxtest/skipfiles/arm64/ltp-io'
        ENVIRONMENT: 'production'
        LTP_TMPDIR: '/scratch'
        LTP_INSTALL_PATH: '/opt/ltp/'
        SHARD_NUMBER: 1
        SHARD_INDEX: 1
        TIMEOUT_MULTIPLIER: 5
      name: ltp-io
- test:
    timeout:
      minutes: 2
    definitions:
    - repository: https://storage.tuxboot.com/test-definitions/2024.06.tar.zst
      lava-signal: kmsg
      from: url
      compression: zstd
      path: automated/linux/ltp/ltp.yaml
      parameters:
        SKIP_INSTALL: 'true'
        TST_CMDFILES: 'math'
        SKIPFILE: '/tuxtest/skipfiles/arm64/ltp-math'
        ENVIRONMENT: 'production'
        LTP_TMPDIR: '/scratch'
        LTP_INSTALL_PATH: '/opt/ltp/'
        SHARD_NUMBER: 1
        SHARD_INDEX: 1
        TIMEOUT_MULTIPLIER: 5
      name: ltp-math
- test:
    timeout:
      minutes: 30
    definitions:
    - repository: https://storage.tuxboot.com/test-definitions/2024.06.tar.zst
      lava-signal: kmsg
      from: url
      compression: zstd
      path: automated/linux/perf/perf.yaml
      parameters:
        SKIP_INSTALL: 'true'
      name: perf
- test:
    timeout:
      minutes: 45
    definitions:
    - repository: https://storage.tuxboot.com/test-definitions/2024.06.tar.zst
      lava-signal: kmsg
      from: url
      compression: zstd
      path: automated/linux/kselftest/kselftest.yaml
      parameters:
        TST_CMDFILES: "arm64"
        KSELFTEST_PATH: "/opt/kselftests/default-in-kernel"
        SKIPFILE: "skipfile-lkft.yaml"
        ENVIRONMENT: "production"
        SHARD_NUMBER: 1
        SHARD_INDEX: 1
      name: kselftest-arm64
- test:
    timeout:
      minutes: 20
    definitions:
    - repository: https://storage.tuxboot.com/test-definitions/2024.06.tar.zst
      lava-signal: kmsg
      from: url
      compression: zstd
      path: automated/linux/kunit/kunit.yaml
      name: kunit
      parameters:
        KUNIT_TEST_MODULE: 'kunit-test.ko'
